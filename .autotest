Autotest.add_hook :initialize do |at|
  %w[.git .DS_Store ._* *.swp].each { |p| at.add_exception(p) }

  dbg = lambda do |str|
    at.output.puts(str) if at.options[:verbose]
  end

  at.add_mapping(%r%^lib/z_k/z_k_event_machine\.rb$%, true) do |f,m|
    at.files_matching(%r%^spec/.*_spec\.rb$%).tap do |foo|
      dbg.call("lib/z_k/z_k_event_machine.rb changed, returning #{foo.inspect}")
    end
  end

  at.add_mapping(%r%^(lib/z_k/.*)\.rb$%, true) do |fname,match|
    at.files_matching(%r%^spec/#{match[1]}_spec\.rb%).tap do |foo|
      dbg.call("#{fname} changed, returning: #{foo.inspect}")
    end
  end
end

# vim:ft=ruby
